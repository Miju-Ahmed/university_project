{% extends 'base.html' %}

{% block title %}{{ profile_user.username }}'s Profile{% endblock %}

{% block content %}
    <h1>{{ profile_user.get_full_name|default:profile_user.username }}'s Profile</h1>

    {# ======================================================= #}
    {# ====        START: THIS IS THE CORRECTED CODE      ==== #}
    {# ======================================================= #}

    {% if profile_user.profile.profile_picture %}
        <img src="{{ profile_user.profile.profile_picture.url }}" alt="Profile Picture" width="150" height="150" style="border-radius: 50%;">
    {% endif %}

    {# ======================================================= #}
    {# ====         END: THIS IS THE CORRECTED CODE       ==== #}
    {# ======================================================= #}


    <p><strong>Username:</strong> {{ profile_user.username }}</p>
    <p><strong>Role:</strong> {{ profile_user.profile.get_user_type_display }}</p>

    <h2>Bio</h2>
    <p>{{ profile_user.profile.bio|default:"No bio provided."|linebreaks }}</p>

    {# --- Display Courses Based on Role --- #}
    {% if profile_user.profile.user_type == 'teacher' %}
        <hr>
        <h2>Courses Taught</h2>
        <ul>
        {% for course in profile_user.profile.teaching_courses.all %}
            <li><a href="{{ course.get_absolute_url }}">{{ course.title }}</a></li>
        {% empty %}
            <li>Not teaching any courses.</li>
        {% endfor %}
        </ul>
    {% elif profile_user.profile.user_type == 'student' %}
        <hr>
        <h2>Enrolled Courses</h2>
        <ul>
        {% for course in profile_user.profile.enrolled_courses.all %}
            <li><a href="{{ course.get_absolute_url }}">{{ course.title }}</a></li>
        {% empty %}
            <li>Not enrolled in any courses.</li>
        {% endfor %}
        </ul>
    {% endif %}


    {% if user == profile_user %}
        <a href="{% url 'profile_edit' %}" class="button">Edit Your Profile</a>
    {% endif %}
{% endblock %}